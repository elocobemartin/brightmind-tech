pipeline {
    agent any
    tools {
    jdk 'JDK21'
    maven 'Maven 3.9.9'
    }
    stages {
        stage('Checkout QA Branch') {
            steps {
                echo 'Checking out QA branch...'
                git branch: 'QA', url: 'https://github.com/elocobemartin/brightmind-tech.git'
            }
        }
        stage('Copy Artifact from Dev') {
            steps {
                echo 'Copying artifact from Dev environment...'
                copyArtifacts(projectName: 'brightmind-tech/Dev', selector: 
                lastSuccessful())
            }
        }
        stage('Deploy to Tomcat (QA)') {
            steps {
                echo 'Deploying to QA Tomcat...'
                script {
                    def warFile = "target/brightmind-tech.war"
                    if (fileExists(warFile)) {
                        deploy adapters: [
                            tomcat9(
                                credentialsId: 'TomcatCreds',
                                url: 'http://localhost:8021'
                            )
                        ], 
                        contextPath: '/brightmind-tech-qa',
                        war: warFile
                    } else {
                        error "WAR file not found. QA deployment failed."
                    }
                }
            }
        }
    }
    post {
        always {
            echo 'Cleaning up workspace...'
            deleteDir()
        }
        success {
            echo 'QA Pipeline completed successfully!'
        }
        failure {
            echo 'QA Pipeline failed. Check build logs for details.'
        }
    }
}