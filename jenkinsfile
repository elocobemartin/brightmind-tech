pipeline {
    agent any
    tools {
        jdk 'JDK21'
        maven 'Maven 3.9.9'
    }
        stages {
            stage('Checkout Prod Branch') {
                steps {
                    echo 'Checking out Prod branch...'
                    git branch: 'Prod', url: 'https://github.com/rollinopz/brightmind-tech.git'
                }
            }
            stage('Copy Artifact from QA') {
                steps {
                    echo 'Copying artifact from QA environment...'
                    copyArtifacts(
                        projectName: 'brightmind-tech-multibranch/QA', 
                        selector: lastSuccessful(),
                        target: 'target/'
                    )
                }
            }
            stage('Approval for Production') {
                steps {
                    echo 'Waiting for production deployment approval...'
                    input message: 'Approve deployment to production?', 
                          ok: 'Deploy to Production',
                          submitterParameter: 'APPROVER'
                }
            }
            stage('Deploy to Tomcat (Prod)') {
                steps {
                    echo 'Deploying to Production Tomcat...'
                    script {
                        def warFile = "target/brightmind-tech.war"
                        if (fileExists(warFile)) {
                            deploy adapters: [
                                tomcat9 (
                                    credentialsId: 'TomcatCreds',
                                    url: 'http://localhost:8022'
                                )
                            ], 
                            contextPath: '/brightmind-tech-prod',
                            war: warFile
                        } else {
                            error "ERROR: WAR file ${warFile} not found! Production deployment failed."
                        }
                    }
                }
            }
        }
        post {
            always {
                echo 'Cleaning up workspace...'
                deleteDir()
            }
            success {
                echo "Production deployment completed successfully! Approved by: 
    ${params.APPROVER}"
            }
            failure {
                echo 'Production pipeline failed. Check build logs for details.'
            }
        }
    }
